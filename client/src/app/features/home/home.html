<div class="auth-container">
    <header class="auth-header">
        <h1>Welcome</h1>
        <p>Create an account or login</p>
    </header>

    <div class="auth-grid">
        <section class="auth-card">
            <div class="tabs">
                <button type="button" [class.active]="activeTab === 'register'"
                (click)="switchTab('register')">Register</button>

                <button type="button" [class.active]="activeTab === 'login'"
                (click)="switchTab('login')">Login</button>
            </div>

            <form *ngIf="activeTab === 'register'" [formGroup]="registerForm" (ngSubmit)="register()" class="form">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" 
                        placeholder="user@example.com"
                        formControlName="email"
                    />
                    <small *ngIf="rf['email'].touched &&
                    rf['email'].invalid">Invalid email</small>
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <div class="password-wrapper">
                        <input [type]="showRegisterPassword ? 'text' : 'password'"
                            placeholder="minimum 8 characters"
                            formControlName="password"
                        />

                        <mat-icon
                            (click)="showRegisterPassword = !showRegisterPassword"
                        >{{ showRegisterPassword ? 'visibility_off' : 'visibility_on' }}</mat-icon>
                    </div>
                    <div *ngIf="rf['password'].touched && rf['password'].value?.length &&
                    rf['password'].invalid" class="password-errors">
                        <small class="title">Password must include</small>
                        <small *ngIf="rf['password'].touched &&
                        rf['password'].errors?.['uppercase']">• one uppercase letter</small>
                        <small *ngIf="rf['password'].touched &&
                        rf['password'].errors?.['lowercase']">• one lowercase letter</small>
                        <small *ngIf="rf['password'].touched &&
                        rf['password'].errors?.['number']">• one number</small>
                        <small *ngIf="rf['password'].touched &&
                        rf['password'].errors?.['special']">• one special character</small>
                        <small *ngIf="rf['password'].touched &&
                        rf['password'].errors?.['space']">• no spaces allowed</small>
                        <small *ngIf="rf['password'].touched &&
                        rf['password'].errors?.['minlength']">• at least 8 characters</small>
                    </div>
                </div>

                <div class="form-group">
                    <label>Confirm Password</label>
                    <div class="password-wrapper">
                        <input [type]="showRegisterConfirmPassword ? 'text' : 'password'"
                            placeholder="re-enter your password"
                            formControlName="confirmPassword"
                        />

                        <mat-icon
                            (click)="showRegisterConfirmPassword = !showRegisterConfirmPassword"
                        >{{ showRegisterConfirmPassword ? 'visibility_off' : 'visibility_on' }}</mat-icon>
                    </div>
                    <small *ngIf="registerForm.errors?.['passwordMismatch']
                    && rf['confirmPassword'].touched">Password do not match</small>
                </div>

                <div class="error" *ngIf="registerError">
                    {{ registerError }}
                </div>

                <button type="submit" [disabled]="registerForm.invalid">
                    Register
                </button>
            </form>

            <form *ngIf="activeTab === 'login'" [formGroup]="loginForm" (ngSubmit)="login()" class="form">
                <div class="form-group">
                    <label>Email / Username</label>
                    <input type="text" 
                        formControlName="identifier" />
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <div class="password-wrapper">
                        <input [type]="showLoginPassword ? 'text' : 'password'"
                            formControlName="password" />

                        <mat-icon
                            (click)="showLoginPassword = !showLoginPassword"
                        >{{ showLoginPassword ? 'visibility_off' : 'visibility_on' }}</mat-icon>
                    </div>
                </div>

                <div class="error" *ngIf="loginError">
                    {{ loginError }}
                </div>

                <button type="submit" [disabled]="loginForm.invalid">Login</button>
            </form>
        </section>
    </div>
</div>

<app-otp-modal
    *ngIf="showOtpModal" (verified)="onOtpVerified()" (close)="closeOtp()"
></app-otp-modal>